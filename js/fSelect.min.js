(function(e){String.prototype.unaccented=function(){var g=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g];var j=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"];var k=this;for(var h=0;h<g.length;h++){k=k.replace(g[h],j[h])}return k};e.fn.fSelect=function(h){if("string"===typeof h){var j=h}else{var j=e.extend({placeholder:"Select some options",numDisplayed:3,overflowText:"{n} selected",searchText:"Search",noResultsText:"No results found",showSearch:true,optionFormatter:false},h)}function g(k,l){this.$select=e(k);this.settings=l;this.create()}g.prototype={create:function(){this.idx=0;this.optgroup=0;this.selected=[].concat(this.$select.val());this.settings.multiple=this.$select.is("[multiple]");var l="";var n="";var m=this.buildOptions(this.$select);if(this.settings.showSearch){l='<div class="fs-search"><input type="search" placeholder="'+this.settings.searchText+'" /></div>'}if(""!==this.settings.noResultsText){n='<div class="fs-no-results hidden">'+this.settings.noResultsText+"</div>"}var k='<div class="fs-label-wrap"><div class="fs-label"></div><span class="fs-arrow"></span></div>';k+='<div class="fs-dropdown hidden">{search}{no-results}<div class="fs-options">'+m+"</div></div>";k=k.replace("{search}",l);k=k.replace("{no-results}",n);this.$select.wrap('<div class="fs-wrap'+(this.settings.multiple?" multiple":"")+'" tabindex="0" />');this.$select.addClass("hidden");this.$select.before(k);this.$wrap=this.$select.closest(".fs-wrap");this.$wrap.data("id",window.fSelect.num_items);window.fSelect.num_items++;this.reloadDropdownLabel()},reload:function(){this.destroy();this.create()},destroy:function(){this.$wrap.find(".fs-label-wrap").remove();this.$wrap.find(".fs-dropdown").remove();this.$select.unwrap().removeClass("hidden")},buildOptions:function(k){var l=this;var m="";k.children().each(function(s,n){var v=e(n);if("optgroup"==v.prop("nodeName").toLowerCase()){m+='<div class="fs-optgroup-label" data-group="'+l.optgroup+'">'+v.prop("label")+"</div>";m+=l.buildOptions(v);l.optgroup++}else{var o=v.prop("value");var p=v.attr("class");p=("undefined"!==typeof p)?" "+p:"";if(0<l.idx||""!=o||!l.settings.multiple){var q=v.is(":disabled")?" disabled":"";var r=-1<e.inArray(o,l.selected)?" selected":"";var t=" g"+l.optgroup;var u='<div class="fs-option'+r+q+t+p+'" data-value="'+o+'" data-index="'+l.idx+'"><span class="fs-checkbox"><i></i></span><div class="fs-option-label">'+v.html()+"</div></div>";if("function"===typeof l.settings.optionFormatter){u=l.settings.optionFormatter(u)}m+=u;l.idx++}}});return m},reloadDropdownLabel:function(){var k=this.settings;var l=[];this.$wrap.find(".fs-option.selected").each(function(m,n){l.push(e(n).find(".fs-option-label").html())});if(l.length<1){l=k.placeholder}else{if(l.length>k.numDisplayed){l=k.overflowText.replace("{n}",l.length)}else{l=l.join(", ")}}this.$wrap.find(".fs-label").html(l);this.$wrap.toggleClass("fs-default",l===k.placeholder)}};return this.each(function(){var k=e(this).data("fSelect");if(!k){k=new g(this,j);e(this).data("fSelect",k)}if("string"===typeof j){k[j]()}})};window.fSelect={num_items:0,active_id:null,active_el:null,last_choice:null,idx:-1};e(document).on("click",".fs-option:not(.hidden, .disabled)",function(n){var p=e(this).closest(".fs-wrap");var h=p.find("select");var j=false;if(p.hasClass("fs-disabled")){return}if(p.hasClass("multiple")){var k=[];if(n.shiftKey&&null!=window.fSelect.last_choice){var m=parseInt(e(this).attr("data-index"));var g=!e(this).hasClass("selected");var l=Math.min(window.fSelect.last_choice,m);var o=Math.max(window.fSelect.last_choice,m);for(i=l;i<=o;i++){p.find(".fs-option[data-index="+i+"]").not(".hidden, .disabled").each(function(){e(this).toggleClass("selected",g)})}}else{window.fSelect.last_choice=parseInt(e(this).attr("data-index"));e(this).toggleClass("selected")}p.find(".fs-option.selected").each(function(q,r){k.push(e(r).attr("data-value"))})}else{var k=e(this).attr("data-value");p.find(".fs-option").removeClass("selected");e(this).addClass("selected");j=true}h.val(k);h.fSelect("reloadDropdownLabel");h.change();e(document).trigger("fs:changed",p);if(j){f(p)}});e(document).on("keyup",".fs-search input",function(j){if(40==j.which){e(this).blur();return}var g=e(this).closest(".fs-wrap");var k=/[|\\{}()[\]^$+*?.]/g;var h=e(this).val().replace(k,"\\$&");g.find(".fs-option, .fs-optgroup-label").removeClass("hidden");if(""!=h){g.find(".fs-option").each(function(){var l=new RegExp(h.unaccented(),"gi");var m=e(this).find(".fs-option-label").text().unaccented();if(null===m.match(l)){e(this).addClass("hidden")}});g.find(".fs-optgroup-label").each(function(){var m=e(this).attr("data-group");var l=e(this).closest(".fs-options").find(".fs-option.g"+m+":not(.hidden)").length;if(l<1){e(this).addClass("hidden")}})}c(g);d(g)});e(document).on("click",function(k){var h=e(k.target);var g=h.closest(".fs-wrap");if(0<g.length){if(g.data("id")!==window.fSelect.active_id){f()}if(h.hasClass("fs-label")||h.hasClass("fs-arrow")){var j=g.find(".fs-dropdown").hasClass("hidden");if(j){a(g)}else{f(g)}}}else{f()}});e(document).on("keydown",function(m){var j=window.fSelect.active_el;var g=e(m.target);if(g.hasClass("fs-wrap")){if(32==m.which||13==m.which){m.preventDefault();g.find(".fs-label").trigger("click");return}}else{if(0<g.closest(".fs-search").length){if(32==m.which){return}}else{if(null===j){return}}}if(38==m.which){m.preventDefault();j.find(".fs-option.hl").removeClass("hl");var l=j.find(".fs-option[data-index="+window.fSelect.idx+"]");var k=l.prevAll(".fs-option:not(.hidden, .disabled)");if(k.length>0){window.fSelect.idx=parseInt(k.attr("data-index"));j.find(".fs-option[data-index="+window.fSelect.idx+"]").addClass("hl");b(j)}else{window.fSelect.idx=-1;j.find(".fs-search input").focus()}}else{if(40==m.which){m.preventDefault();var l=j.find(".fs-option[data-index="+window.fSelect.idx+"]");if(l.length<1){var h=j.find(".fs-option:not(.hidden, .disabled):first")}else{var h=l.nextAll(".fs-option:not(.hidden, .disabled)")}if(h.length>0){window.fSelect.idx=parseInt(h.attr("data-index"));j.find(".fs-option.hl").removeClass("hl");j.find(".fs-option[data-index="+window.fSelect.idx+"]").addClass("hl");b(j)}}else{if(32==m.which||13==m.which){m.preventDefault();j.find(".fs-option.hl").click()}else{if(27==m.which){f(j)}}}}});function d(g){var h=g.find(".fs-option:not(.hidden)").length>0;g.find(".fs-no-results").toggleClass("hidden",h)}function c(g){g.find(".fs-option.hl").removeClass("hl");g.find(".fs-search input").focus();window.fSelect.idx=-1}function b(h){var m=h.find(".fs-options");var j=h.find(".fs-option.hl");var o=j.offset().top+m.scrollTop();var l=o+j.outerHeight();var k=m.offset().top+m.scrollTop();var g=k+m.outerHeight();if(l>g){var n=m.scrollTop()+l-g;m.scrollTop(n)}else{if(o<k){var n=m.scrollTop()-k-o;m.scrollTop(n)}}}function a(g){window.fSelect.active_el=g;window.fSelect.active_id=g.data("id");window.fSelect.initial_values=g.find("select").val();e(document).trigger("fs:opened",g);g.find(".fs-dropdown").removeClass("hidden");g.addClass("fs-open");c(g);d(g)}function f(g){if("undefined"==typeof g&&null!=window.fSelect.active_el){g=window.fSelect.active_el}if("undefined"!==typeof g){var j=window.fSelect.initial_values;var h=g.find("select").val();if(JSON.stringify(j)!=JSON.stringify(h)){e(document).trigger("fs:closed",g)}}e(".fs-wrap").removeClass("fs-open");e(".fs-dropdown").addClass("hidden");window.fSelect.active_el=null;window.fSelect.active_id=null;window.fSelect.last_choice=null}})(jQuery);